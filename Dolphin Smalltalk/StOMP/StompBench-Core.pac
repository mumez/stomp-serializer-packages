|package|package := Package name: 'StompBench-Core'.package paxVersion: 1; basicComment: ''.package basicPackageVersion: ''.package classNamesadd: #StompBench;add: #StompBossBench;add: #StompFuelBench;add: #StompSmartRefStreamBench;add: #StompSrpBench;add: #StompXtreamsBench;yourself.package binaryGlobalNames: Set new.package globalAliases: Set new.package!Object subclass: #StompBench	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'StompBench-Core'!StompBench subclass: #StompBossBench	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'StompBench-Core'!StompBench subclass: #StompFuelBench	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'StompBench-Core'!StompBench subclass: #StompSmartRefStreamBench	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'StompBench-Core'!StompBench subclass: #StompSrpBench	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'StompBench-Core'!StompBench subclass: #StompXtreamsBench	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'StompBench-Core'!!StompBench class methodsFor: 'utilities'!benchAll	"self benchAll"	Transcript cr; show: '**', self name, '**'.	(StompBench class organization listAtCategoryNamed: #actions) do: [:each | self perform: each]! !!StompBench class methodsFor: 'factories'!blogPost01	"self blogPost01"	| blogPost |	blogPost := StompMockBlogPost new.	blogPost id: 1;	 title: 'My Smalltalk';	 status: 0; 	content: (self randomPhraseSized: 5000); 	creationDate: (StompPortableUtil default timestampFromNanoseconds: 3465089041421000000);	modifiedDate: (StompPortableUtil default timestampFromNanoseconds: 3465089112345000000); 	author: (StompMockAuthor authors at: #ume); 	categories: (Array with: (StompMockCategory categories at: #life)); 	tags: (Array with: (StompMockTag tags at: #visualworks) with: (StompMockTag tags at: #trans)).	^ blogPost ! !!StompBench class methodsFor: 'factories'!blogPost02	"self blogPost02"	| posts post |	posts := OrderedCollection new.	1 to: 20 do: [:idx |		posts add: (self blogPost01 id: idx printString)	].	1 to: 5 do: [:idx |		post := posts at: idx.		post attachments: (Array with: StompMockAttachment attachment1 with: StompMockAttachment attachment2).		post modifiedDate: (StompPortableUtil default timestampFromNanoseconds: 3465089051421000000).		post comments: (Array with: self protoBlogComment with: self protoBlogComment).	].	^posts	! !!StompBench class methodsFor: 'hooks'!checkSerializerExists	"override"	^true! !!StompBossBench class methodsFor: 'hooks'!checkSerializerExists	"override"	^(Smalltalk at: #BinaryObjectStorage ifAbsent:[]) notNil! !!StompFuelBench class methodsFor: 'hooks'!checkSerializerExists	"override"	^Smalltalk includesKey: #FLSerializer! !!StompSmartRefStreamBench class methodsFor: 'hooks'!checkSerializerExists	"override"	^Smalltalk includesKey: #SmartRefStream! !!StompSrpBench class methodsFor: 'hooks'!checkSerializerExists	"override"	^(Smalltalk at: #SrpConfiguration ifAbsent: [Smalltalk at: #SRP ifAbsent:[]]) notNil! !!StompXtreamsBench class methodsFor: 'hooks'!checkSerializerExists	"override"	^(Smalltalk at: #ObjectWriteStream ifAbsent: [Smalltalk at: #Xtreams ifAbsent:[]]) notNil! !!StompBench class methodsFor: 'hooks'!deserialize: bytes	"override"	^Object fromStomp: bytes! !!StompBossBench class methodsFor: 'hooks'!deserialize: bytes	| stream bos data |	stream := ReadStream on: bytes.	bos := BinaryObjectStorage onOld: stream.	data := bos next.	bos close.	^data! !!StompFuelBench class methodsFor: 'hooks'!deserialize: bytes	| des |	des := (FLMaterializer on: bytes readStream) .	des materialize.	^ des root.! !!StompSmartRefStreamBench class methodsFor: 'hooks'!deserialize: bytes	^SmartRefStream objectFromStreamedRepresentation: bytes! !!StompSrpBench class methodsFor: 'hooks'!deserialize: bytes	^SrpConfiguration default loadObjectFrom: bytes! !!StompXtreamsBench class methodsFor: 'hooks'!deserialize: bytes	^ bytes reading marshaling get! !!StompBench class methodsFor: 'template'!doBench: selector repeating: repeats	| target bytes readTime times writeTime |	target := self perform: selector.	times := repeats.		self checkSerializerExists ifFalse: [self error: 'Serializer does not exist!!'].	writeTime := [		times timesRepeat: [bytes := self serialize: target]	] timeToRun.	readTime := [		times timesRepeat: [self deserialize: bytes]	] timeToRun.	Transcript cr; show: thisContext sender selector; space;		show: 'writeTime: ', writeTime printString; space;		show: 'readTime: ', readTime printString; space;		show: 'total: ', (writeTime + readTime) printString; space;		show: 'size: ', (bytes size printString)! !!StompBench class methodsFor: 'factories'!order01	| items order |	items := Dictionary new.	items at: (StompMockOrderItem new id: 123 ; title: 'foofoofoo'; price: 2980) put: 2.	items at: (StompMockOrderItem new id: 456 ; title: 'barbarbar'; price: 1980) put: 1.	items at: (StompMockOrderItem new id: 789 ; title: 'bazbazbaz'; price: 5980) put: 1.		order := StompMockOrder new.	order items: 12345678901234567890.	order items: items.		^order! !!StompBench class methodsFor: 'factories'!person01	| dict phoneNumbers |	phoneNumbers := OrderedCollection new.	phoneNumbers add: (Array with: 0 with: '000-1111-2222').	phoneNumbers add: (Array with: 1 with: '222-3333-4444').	phoneNumbers add: (Array with: 2 with: '555-6666-7777').		dict := Dictionary new.	dict at: 'id' put: self random.	dict at: 'name' put: (self randomPhraseSized: 20).	dict at: 'phoneNumbers' put: phoneNumbers.		^dict! !!StompBench class methodsFor: 'factories helper'!protoBlogComment	| comment |	comment := StompMockComment new id: self random.	comment content: (self randomPhraseSized: 100).	comment accepted: false.	comment count: self random.	comment author: (StompMockAuthor authors at: #yama).	comment creationDate: (StompPortableUtil default timestampFromNanoseconds: 3485089041421000000).	^ comment! !!StompBench class methodsFor: 'factories helper'!protoSearchBody	| body |	body := StompMockSearchBody new.	body numFounds: 3.	body start: 0.	^ body! !!StompBench class methodsFor: 'factories helper'!protoSearchDoc	| cats1 doc1 features1 |	doc1 := StompMockSearchDocument new.	doc1 id: 'MA147LL/A'.	doc1 name: '60 GB iPod with Video Playback Black'.	doc1 price: 399.0.	doc1 popularity: self random.	doc1 inStock: true.	doc1 timestamp: (StompPortableUtil default timestampFromNanoseconds: 3485089041421000000).	cats1 := Array with: 'electoronics' with: 'music'.	doc1 categories: cats1.	features1 := OrderedCollection new.	features1 add: (self randomPhraseSized: 30).	features1 add: (self randomPhraseSized: 70).	features1 add: (self randomPhraseSized: 50).	doc1 features: features1.	^ doc1! !!StompBench class methodsFor: 'factories helper'!protoSearchHeader	| header params |	header := StompMockSearchHeader new.	header status: 0.	header time: 10.	params := Dictionary new.	params at: 'wt' put: 'json'.	params at: 'indent' put: 'on'.	params at: 'hl' put: true.	header params: params.	^ header! !!StompBench class methodsFor: 'factories helper'!protoSearchHighlight	| highlight1 |	highlight1 := StompMockSearchHighlight new.	highlight1 name: (Array with: (self randomPhraseSized: 50)).	highlight1 features: (Array with: (self randomPhraseSized: 70)).	^ highlight1! !!StompBench class methodsFor: 'utilities'!random	^ self randomRanged: 50! !!StompBench class methodsFor: 'utilities'!randomPhraseSized: size	"self randomPhraseSized: 30"	| str |	str := ''.	[str := str, ' ', self randomWord.	str size < size] whileTrue.	^str copyFrom: 1 to: size ! !!StompBench class methodsFor: 'utilities'!randomRanged: anInteger	^ (Random new next * anInteger) ceiling! !!StompBench class methodsFor: 'utilities'!randomWord	^(Object selectors at: self random) asString! !!StompBench class methodsFor: 'factories'!searchResult01	"self searchResult01"	| resp header body docs highlights |	resp := StompMockSearchResponse new.	header := self protoSearchHeader.	body := self protoSearchBody.	docs := OrderedCollection new.	docs add: (self protoSearchDoc).	docs add: (self protoSearchDoc).	docs add: (self protoSearchDoc).	body docs: docs.	highlights := Dictionary new.	highlights at: 'MA147LL/A' put: self protoSearchHighlight.	highlights at: 'MA147LL/B' put: self protoSearchHighlight.	highlights at: 'MA147LL/C' put: self protoSearchHighlight.	resp header: header; body: body; highlightings: highlights.	^resp! !!StompBench class methodsFor: 'factories'!searchResult02	"self searchResult02"	| resp header body docs ids highlights |	resp := StompMockSearchResponse new.	header := self protoSearchHeader.	body := self protoSearchBody.	docs := OrderedCollection new.	ids := 1 to: 50.	ids do: [:eachId | docs add: (self protoSearchDoc id: eachId printString)].	body docs: docs.	highlights := Dictionary new.	ids do: [:eachId |		highlights at: eachId printString put: self protoSearchHighlight.	].	resp header: header; body: body; highlightings: highlights.	^resp! !!StompBench class methodsFor: 'hooks'!serialize: anObject	"override"	^anObject toStomp! !!StompBossBench class methodsFor: 'hooks'!serialize: anObject	| stream bos |	stream := WriteStream on: ByteArray new.	bos := BinaryObjectStorage onNew: stream.	bos nextPut: anObject.	bos close.	^stream contents! !!StompFuelBench class methodsFor: 'hooks'!serialize: anObject	| ser |	ser := (FLSerializer on: ByteArray new writeStream) .	ser serialize: anObject.	^ ser stream contents.! !!StompSmartRefStreamBench class methodsFor: 'hooks'!serialize: anObject	^SmartRefStream streamedRepresentationOf: anObject! !!StompSrpBench class methodsFor: 'hooks'!serialize: anObject	^SrpConfiguration default saveObject: anObject! !!StompXtreamsBench class methodsFor: 'hooks'!serialize: anObject	^ByteArray new writing marshaling put: anObject; conclusion.! !!StompBench class methodsFor: 'factories'!session01	| session properties |	session := StompMockSession new id: 'd21d3f1a-0a21-054a-b106-93fa445b337c'.	session expires: 60 seconds.	properties := Dictionary new.	properties at: 'url' put: 'http://somehost.com:9090/someService/some/'.	properties at: 'token' put: 'someToken'.	properties at: '_k' put: 'c20036b7-12a0-b446-a1ac-280a4dc102bc'.	session properties: properties.	^session! !!StompBench class methodsFor: 'actions'!writeReadBlogPost01	"self writeReadBlogPost01"	self doBench: #blogPost01 repeating: 200! !!StompBench class methodsFor: 'actions'!writeReadBlogPost02	"self writeReadBlogPost02"	self doBench: #blogPost02 repeating: 2! !!StompBench class methodsFor: 'actions'!writeReadOrder01	"self writeReadOrder01"	self doBench: #order01 repeating: 1000! !!StompBench class methodsFor: 'actions'!writeReadPerson01	"self writeReadPerson01"	self doBench: #person01 repeating: 1000! !!StompBench class methodsFor: 'actions'!writeReadSearchResult01	"self writeReadSearchResult01"	self doBench: #searchResult01 repeating: 200! !!StompBench class methodsFor: 'actions'!writeReadSearchResult02	"self writeReadSearchResult02"	self doBench: #searchResult02 repeating: 50! !!StompBench class methodsFor: 'actions'!writeReadSession01	"self writeReadSession01"	self doBench: #session01 repeating: 1000! !